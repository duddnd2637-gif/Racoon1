<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÑàÍµ¨Î¶¨ Í≤åÏûÑ - Î†àÌä∏Î°ú ÏïÑÏºÄÏù¥Îìú</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Firebase ÏÑ§Ï†ï (Ïó¨Í∏∞Ïóê Î≥∏Ïù∏Ïùò Firebase ÏÑ§Ï†ïÏùÑ ÎÑ£ÏúºÏÑ∏Ïöî)
        const firebaseConfig = {
            apiKey: "AIzaSyCq1t4GY5W66UICsz4kF-imGo3f2w1e8Os",
  authDomain: "racoon-30f45.firebaseapp.com",
  databaseURL: "https://racoon-30f45-default-rtdb.firebaseio.com",
  projectId: "racoon-30f45",
  storageBucket: "racoon-30f45.firebasestorage.app",
  messagingSenderId: "79082476938",
  appId: "1:79082476938:web:b860f672808fc3b778e473",
  measurementId: "G-HSX70YBRZR"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        const RaccoonGame = () => {
            const GRID_SIZE = 15;
            const CELL_SIZE = 40;
            
            const [gameState, setGameState] = useState('login'); // login, menu, playing, won, lost, leaderboard
            const [playerName, setPlayerName] = useState('');
            const [studentId, setStudentId] = useState('');
            const [level, setLevel] = useState(1);
            const [score, setScore] = useState(0);
            const [lives, setLives] = useState(3);
            const [playerPos, setPlayerPos] = useState({ x: 1, y: 1 });
            const [fruits, setFruits] = useState([]);
            const [tacks, setTacks] = useState([]);
            const [invincible, setInvincible] = useState(false);
            const [leaderboard, setLeaderboard] = useState([]);
            const [currentPlayerId, setCurrentPlayerId] = useState(null);

            // ÏàúÏúÑÌëú Î∂àÎü¨Ïò§Í∏∞
            const loadLeaderboard = useCallback(() => {
                database.ref('leaderboard').orderByChild('score').limitToLast(10).once('value', (snapshot) => {
                    const data = [];
                    snapshot.forEach((child) => {
                        data.push({ id: child.key, ...child.val() });
                    });
                    setLeaderboard(data.reverse());
                });
            }, []);

            // Ï†êÏàò Ï†ÄÏû•
            const saveScore = useCallback((finalScore, finalLevel) => {
                const scoreData = {
                    name: playerName,
                    studentId: studentId,
                    score: finalScore,
                    level: finalLevel,
                    timestamp: Date.now()
                };

                if (currentPlayerId) {
                    // Í∏∞Ï°¥ Ï†êÏàòÎ≥¥Îã§ ÎÜíÏúºÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
                    database.ref('leaderboard/' + currentPlayerId).once('value', (snapshot) => {
                        const existingData = snapshot.val();
                        if (!existingData || finalScore > existingData.score) {
                            database.ref('leaderboard/' + currentPlayerId).set(scoreData);
                        }
                    });
                } else {
                    // ÏÉàÎ°úÏö¥ Í∏∞Î°ù Ï∂îÍ∞Ä
                    const newRef = database.ref('leaderboard').push();
                    newRef.set(scoreData);
                    setCurrentPlayerId(newRef.key);
                }
            }, [playerName, studentId, currentPlayerId]);

            // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
            const handleLogin = (e) => {
                e.preventDefault();
                if (playerName.trim() && studentId.trim()) {
                    setGameState('menu');
                    loadLeaderboard();
                }
            };

            // Î†àÎ≤® Ï¥àÍ∏∞Ìôî
            const initLevel = useCallback((levelNum) => {
                const newFruits = [];
                const newTacks = [];
                
                const fruitCount = 5 + levelNum * 2;
                for (let i = 0; i < fruitCount; i++) {
                    let pos;
                    do {
                        pos = {
                            x: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1,
                            y: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1
                        };
                    } while (
                        (pos.x === 1 && pos.y === 1) ||
                        newFruits.some(f => f.x === pos.x && f.y === pos.y)
                    );
                    newFruits.push(pos);
                }
                
                const tackCount = 8 + levelNum * 3;
                for (let i = 0; i < tackCount; i++) {
                    let pos;
                    do {
                        pos = {
                            x: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1,
                            y: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1
                        };
                    } while (
                        (pos.x === 1 && pos.y === 1) ||
                        newFruits.some(f => f.x === pos.x && f.y === pos.y) ||
                        newTacks.some(t => t.x === pos.x && t.y === pos.y)
                    );
                    newTacks.push(pos);
                }
                
                setFruits(newFruits);
                setTacks(newTacks);
                setPlayerPos({ x: 1, y: 1 });
            }, []);

            // Í≤åÏûÑ ÏãúÏûë
            const startGame = () => {
                setGameState('playing');
                setLevel(1);
                setScore(0);
                setLives(3);
                initLevel(1);
            };

            // ÌÇ§Î≥¥Îìú Ï°∞Ïûë
            useEffect(() => {
                if (gameState !== 'playing') return;

                const handleKeyPress = (e) => {
                    const { x, y } = playerPos;
                    let newX = x;
                    let newY = y;

                    switch(e.key) {
                        case 'ArrowUp':
                            newY = Math.max(0, y - 1);
                            break;
                        case 'ArrowDown':
                            newY = Math.min(GRID_SIZE - 1, y + 1);
                            break;
                        case 'ArrowLeft':
                            newX = Math.max(0, x - 1);
                            break;
                        case 'ArrowRight':
                            newX = Math.min(GRID_SIZE - 1, x + 1);
                            break;
                        default:
                            return;
                    }

                    e.preventDefault();
                    setPlayerPos({ x: newX, y: newY });
                };

                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [playerPos, gameState]);

            // Ï∂©Îèå Ï≤¥ÌÅ¨ Î∞è ÏïÑÏù¥ÌÖú ÏàòÏßë
            useEffect(() => {
                if (gameState !== 'playing') return;

                const fruitIndex = fruits.findIndex(f => f.x === playerPos.x && f.y === playerPos.y);
                if (fruitIndex !== -1) {
                    setFruits(fruits.filter((_, i) => i !== fruitIndex));
                    setScore(score + 100);
                    
                    if (fruits.length === 1) {
                        setTimeout(() => {
                            setLevel(level + 1);
                            initLevel(level + 1);
                            setScore(score + 500);
                        }, 300);
                    }
                }

                if (!invincible) {
                    const hitTack = tacks.some(t => t.x === playerPos.x && t.y === playerPos.y);
                    if (hitTack) {
                        setLives(lives - 1);
                        setInvincible(true);
                        
                        if (lives <= 1) {
                            setGameState('lost');
                            saveScore(score, level);
                            loadLeaderboard();
                        } else {
                            setTimeout(() => {
                                setInvincible(false);
                            }, 1000);
                        }
                    }
                }
            }, [playerPos, fruits, tacks, gameState, score, lives, level, invincible, initLevel, saveScore, loadLeaderboard]);

            // Í≤åÏûÑ ÌôîÎ©¥ Î†åÎçîÎßÅ
            const renderGrid = () => {
                const cells = [];
                
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        const isPlayer = playerPos.x === x && playerPos.y === y;
                        const isFruit = fruits.some(f => f.x === x && f.y === y);
                        const isTack = tacks.some(t => t.x === x && t.y === y);
                        const isWall = x === 0 || y === 0 || x === GRID_SIZE - 1 || y === GRID_SIZE - 1;
                        
                        cells.push(
                            React.createElement('div', {
                                key: `${x}-${y}`,
                                style: {
                                    width: CELL_SIZE,
                                    height: CELL_SIZE,
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontSize: '24px',
                                    backgroundColor: isWall ? '#8B4513' : '#90EE90',
                                    border: '1px solid #006400',
                                    opacity: invincible && isPlayer ? (Date.now() % 400 < 200 ? 0.3 : 1) : 1,
                                }
                            },
                                isPlayer && 'ü¶ù',
                                isFruit && 'üçé',
                                isTack && 'üåπ'
                            )
                        );
                    }
                }
                
                return cells;
            };

            return React.createElement('div', {
                style: { 
                    width: '100vw', 
                    height: '100vh', 
                    display: 'flex', 
                    flexDirection: 'column',
                    alignItems: 'center', 
                    justifyContent: 'center',
                    backgroundColor: '#1a1a2e',
                    fontFamily: 'Arial, sans-serif',
                    color: 'white',
                    overflow: 'auto'
                }
            },
                // Î°úÍ∑∏Ïù∏ ÌôîÎ©¥
                gameState === 'login' && React.createElement('div', { 
                    style: { 
                        textAlign: 'center',
                        backgroundColor: '#16213e',
                        padding: '40px',
                        borderRadius: '20px',
                        boxShadow: '0 10px 30px rgba(0,0,0,0.5)'
                    } 
                },
                    React.createElement('h1', { 
                        style: { fontSize: '48px', marginBottom: '30px', color: '#FFD700' }
                    }, 'ü¶ù ÎÑàÍµ¨Î¶¨ Í≤åÏûÑ üçé'),
                    React.createElement('form', { 
                        onSubmit: handleLogin,
                        style: { display: 'flex', flexDirection: 'column', gap: '20px' }
                    },
                        React.createElement('input', {
                            type: 'text',
                            placeholder: 'Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                            value: playerName,
                            onChange: (e) => setPlayerName(e.target.value),
                            required: true,
                            style: {
                                padding: '15px',
                                fontSize: '18px',
                                borderRadius: '10px',
                                border: '2px solid #FFD700',
                                backgroundColor: '#0f3460',
                                color: 'white'
                            }
                        }),
                        React.createElement('input', {
                            type: 'text',
                            placeholder: 'ÌïôÎ≤àÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                            value: studentId,
                            onChange: (e) => setStudentId(e.target.value),
                            required: true,
                            style: {
                                padding: '15px',
                                fontSize: '18px',
                                borderRadius: '10px',
                                border: '2px solid #FFD700',
                                backgroundColor: '#0f3460',
                                color: 'white'
                            }
                        }),
                        React.createElement('button', {
                            type: 'submit',
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#FFD700',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e',
                                marginTop: '10px'
                            }
                        }, 'Í≤åÏûÑ ÏãúÏûë üéÆ')
                    )
                ),

                // Î©îÎâ¥ ÌôîÎ©¥
                gameState === 'menu' && React.createElement('div', { style: { textAlign: 'center' } },
                    React.createElement('h1', { 
                        style: { fontSize: '48px', marginBottom: '20px', color: '#FFD700' }
                    }, `ÌôòÏòÅÌï©ÎãàÎã§, ${playerName}Îãò!`),
                    React.createElement('p', { 
                        style: { fontSize: '20px', marginBottom: '30px' }
                    }, 'ÏïïÏ†ïÏùÑ ÌîºÌïòÍ≥† Í≥ºÏùºÏùÑ Î™®Îëê Î®πÏúºÏÑ∏Ïöî!'),
                    React.createElement('div', { 
                        style: { marginBottom: '30px', textAlign: 'left', display: 'inline-block' }
                    },
                        React.createElement('p', null, 'ü¶ù ÎÑàÍµ¨Î¶¨: ÌîåÎ†àÏù¥Ïñ¥'),
                        React.createElement('p', null, 'üçé Í≥ºÏùº: 100Ï†ê (Î™®Îëê Î®πÏúºÎ©¥ Îã§Ïùå Ïä§ÌÖåÏù¥ÏßÄ!)'),
                        React.createElement('p', null, 'üåπ ÏïïÏ†ï: ÎãøÏúºÎ©¥ ÏÉùÎ™Ö -1'),
                        React.createElement('p', null, '‚å®Ô∏è ÌôîÏÇ¥Ìëú ÌÇ§Î°ú Ï°∞Ïûë')
                    ),
                    React.createElement('div', { style: { display: 'flex', gap: '20px', justifyContent: 'center' } },
                        React.createElement('button', {
                            onClick: startGame,
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#FFD700',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'üéÆ Í≤åÏûÑ ÏãúÏûë'),
                        React.createElement('button', {
                            onClick: () => setGameState('leaderboard'),
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#4ECDC4',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'üèÜ ÏàúÏúÑÌëú')
                    )
                ),

                // Í≤åÏûÑ ÌîåÎ†àÏù¥ ÌôîÎ©¥
                gameState === 'playing' && React.createElement('div', null,
                    React.createElement('div', { 
                        style: { 
                            display: 'flex', 
                            justifyContent: 'space-between', 
                            marginBottom: '20px',
                            fontSize: '24px',
                            fontWeight: 'bold'
                        }
                    },
                        React.createElement('div', { style: { display: 'flex', gap: '30px' } },
                            React.createElement('span', null, `üë§ ${playerName}`),
                            React.createElement('span', null, `‚≠ê Î†àÎ≤®: ${level}`),
                            React.createElement('span', null, `üèÜ Ï†êÏàò: ${score}`),
                            React.createElement('span', null, `‚ù§Ô∏è ÏÉùÎ™Ö: ${lives}`)
                        ),
                        React.createElement('div', null, `üçé ÎÇ®ÏùÄ Í≥ºÏùº: ${fruits.length}`)
                    ),
                    
                    React.createElement('div', { 
                        style: { 
                            display: 'grid', 
                            gridTemplateColumns: `repeat(${GRID_SIZE}, ${CELL_SIZE}px)`,
                            gap: '0',
                            border: '4px solid #FFD700',
                            boxShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                        }
                    }, renderGrid()),
                    
                    React.createElement('div', { 
                        style: { 
                            marginTop: '20px', 
                            textAlign: 'center',
                            fontSize: '16px',
                            color: '#aaa'
                        }
                    }, '‚å®Ô∏è ÌôîÏÇ¥Ìëú ÌÇ§Î°ú ÎÑàÍµ¨Î¶¨Î•º ÏõÄÏßÅÏù¥ÏÑ∏Ïöî!')
                ),

                // Í≤åÏûÑ Ïò§Î≤Ñ ÌôîÎ©¥
                gameState === 'lost' && React.createElement('div', { style: { textAlign: 'center' } },
                    React.createElement('h1', { style: { fontSize: '48px', color: '#FF6B6B' } }, 'Í≤åÏûÑ Ïò§Î≤Ñ!'),
                    React.createElement('p', { 
                        style: { fontSize: '32px', margin: '30px 0' }
                    }, `ÏµúÏ¢Ö Ï†êÏàò: ${score}`),
                    React.createElement('p', { 
                        style: { fontSize: '24px', marginBottom: '30px' }
                    }, `Î†àÎ≤® ${level}ÍπåÏßÄ ÎèÑÎã¨ÌñàÏäµÎãàÎã§!`),
                    React.createElement('div', { style: { display: 'flex', gap: '20px', justifyContent: 'center' } },
                        React.createElement('button', {
                            onClick: startGame,
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#FFD700',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'Îã§Ïãú ÏãúÏûë'),
                        React.createElement('button', {
                            onClick: () => { loadLeaderboard(); setGameState('leaderboard'); },
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#4ECDC4',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'ÏàúÏúÑÌëú Î≥¥Í∏∞')
                    )
                ),

                // ÏàúÏúÑÌëú ÌôîÎ©¥
                gameState === 'leaderboard' && React.createElement('div', { 
                    style: { 
                        textAlign: 'center',
                        backgroundColor: '#16213e',
                        padding: '40px',
                        borderRadius: '20px',
                        minWidth: '500px'
                    } 
                },
                    React.createElement('h1', { 
                        style: { fontSize: '48px', marginBottom: '30px', color: '#FFD700' }
                    }, 'üèÜ ÏàúÏúÑÌëú'),
                    React.createElement('div', { 
                        style: { 
                            marginBottom: '30px',
                            maxHeight: '400px',
                            overflowY: 'auto'
                        }
                    },
                        leaderboard.length === 0 ? 
                            React.createElement('p', { style: { fontSize: '20px', color: '#aaa' } }, 'ÏïÑÏßÅ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§') :
                            leaderboard.map((entry, index) => 
                                React.createElement('div', {
                                    key: entry.id,
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        padding: '15px',
                                        margin: '10px 0',
                                        backgroundColor: index < 3 ? '#FFD700' : '#0f3460',
                                        color: index < 3 ? '#1a1a2e' : 'white',
                                        borderRadius: '10px',
                                        fontSize: '18px',
                                        fontWeight: index < 3 ? 'bold' : 'normal'
                                    }
                                },
                                    React.createElement('span', null, `${index + 1}. ${entry.name} (${entry.studentId})`),
                                    React.createElement('span', null, `${entry.score}Ï†ê - Lv.${entry.level}`)
                                )
                            )
                    ),
                    React.createElement('button', {
                        onClick: () => setGameState('menu'),
                        style: {
                            padding: '15px 40px',
                            fontSize: '24px',
                            backgroundColor: '#FFD700',
                            border: 'none',
                            borderRadius: '10px',
                            cursor: 'pointer',
                            fontWeight: 'bold',
                            color: '#1a1a2e'
                        }
                    }, 'Î©îÎâ¥Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞')
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(RaccoonGame));
    </script>
</body>
</html>